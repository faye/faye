!function(){"use strict";var t={VERSION:"0.8.9",BAYEUX_VERSION:"1.0",ID_LENGTH:160,JSONP_CALLBACK:"jsonpcallback",CONNECTION_TYPES:["long-polling","cross-origin-long-polling","callback-polling","websocket","eventsource","in-process"],MANDATORY_CONNECTION_TYPES:["long-polling","callback-polling","in-process"],ENV:"undefined"!=typeof window?window:global,extend:function(t,e,n){if(!e)return t;for(var i in e)e.hasOwnProperty(i)&&(t.hasOwnProperty(i)&&n===!1||t[i]!==e[i]&&(t[i]=e[i]));return t},random:function(t){if(t=t||this.ID_LENGTH,t>32){for(var e=Math.ceil(t/32),n="";e--;)n+=this.random(32);for(var i=n.split(""),s="";i.length>0;)s+=i.pop();return s}for(var r=Math.pow(2,t)-1,o=r.toString(36).length,n=Math.floor(Math.random()*r).toString(36);n.length<o;)n="0"+n;return n},clientIdFromMessages:function(t){var e=[].concat(t)[0];return e&&e.clientId},copyObject:function(e){var n,i,s;if(e instanceof Array){for(n=[],i=e.length;i--;)n[i]=t.copyObject(e[i]);return n}if("object"==typeof e){n=null===e?null:{};for(s in e)n[s]=t.copyObject(e[s]);return n}return e},commonElement:function(t,e){for(var n=0,i=t.length;i>n;n++)if(-1!==this.indexOf(e,t[n]))return t[n];return null},indexOf:function(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0,i=t.length;i>n;n++)if(t[n]===e)return n;return-1},map:function(t,e,n){if(t.map)return t.map(e,n);var i=[];if(t instanceof Array)for(var s=0,r=t.length;r>s;s++)i.push(e.call(n||null,t[s],s));else for(var o in t)t.hasOwnProperty(o)&&i.push(e.call(n||null,o,t[o]));return i},filter:function(t,e,n){for(var i=[],s=0,r=t.length;r>s;s++)e.call(n||null,t[s],s)&&i.push(t[s]);return i},asyncEach:function(t,e,n,i){var s=t.length,r=-1,o=0,c=!1,a=function(){return o-=1,r+=1,r===s?n&&n.call(i):(e(t[r],u),void 0)},h=function(){if(!c){for(c=!0;o>0;)a();c=!1}},u=function(){o+=1,h()};u()},toJSON:function(t){return JSON.stringify(t,function(t,e){return this[t]instanceof Array?this[t]:e})}};"undefined"!=typeof module?module.exports=t:"undefined"!=typeof window&&(window.Faye=t),t.Class=function(e,n){"function"!=typeof e&&(n=e,e=Object);var i=function(){return this.initialize?this.initialize.apply(this,arguments)||this:this},s=function(){};return s.prototype=e.prototype,i.prototype=new s,t.extend(i.prototype,n),i},t.Namespace=t.Class({initialize:function(){this._used={}},exists:function(t){return this._used.hasOwnProperty(t)},generate:function(){for(var e=t.random();this._used.hasOwnProperty(e);)e=t.random();return this._used[e]=e},release:function(t){delete this._used[t]}}),function(){var e,n=setTimeout;e="function"==typeof setImmediate?setImmediate:"object"==typeof process&&process.nextTick?process.nextTick:function(t){n(t,0)};var i=0,s=1,r=2,o=function(t){return t},c=function(t){throw t},a=function(t){if(this._state=i,this._callbacks=[],this._errbacks=[],"function"==typeof t){var e=this;t(function(t){f(e,t)},function(t){d(e,t)})}};a.prototype.then=function(t,e){var n=this;return new a(function(i,s){var r={fulfill:i,reject:s};h(n,t,r),u(n,e,r)})};var h=function(t,e,n){"function"!=typeof e&&(e=o);var r=function(t){l(e,t,n)};t._state===i?t._callbacks.push(r):t._state===s&&r(t._value)},u=function(t,e,n){"function"!=typeof e&&(e=c);var s=function(t){l(e,t,n)};t._state===i?t._errbacks.push(s):t._state===r&&s(t._reason)},l=function(t,n,i){e(function(){try{var e=t(n);e&&"function"==typeof e.then?e.then(i.fulfill,i.reject):i.fulfill(e)}catch(s){i.reject(s)}})},f=a.fulfill=function(t,e){if(t._state===i){t._state=s,t._value=e,t._errbacks=[];for(var n,r=t._callbacks;n=r.shift();)n(e)}},d=a.reject=function(t,e){if(t._state===i){t._state=r,t._reason=e,t._callbacks=[];for(var n,s=t._errbacks;n=s.shift();)n(e)}};a.pending=function(){var t={};return t.promise=new a(function(e,n){t.fulfill=e,t.reject=n}),t},a.fulfilled=function(t){return new a(function(e){e(t)})},a.rejected=function(t){return new a(function(e,n){n(t)})},void 0===t?module.exports=a:t.Promise=a}(),t.URI={isURI:function(t){return t&&t.protocol&&t.host&&t.path},isSameOrigin:function(e){var n=t.ENV.location;return e.protocol===n.protocol&&e.hostname===n.hostname&&e.port===n.port},parse:function(e){if("string"!=typeof e)return e;var n,i,s,r,o,c,a={},h=function(t,n){e=e.replace(n,function(e){return a[t]=e,""}),a[t]=a[t]||""};for(h("protocol",/^[a-z]+\:/i),h("host",/^\/\/[^\/\?#]+/),/^\//.test(e)||a.host||(e=t.ENV.location.pathname.replace(/[^\/]*$/,"")+e),h("pathname",/^[^\?#]*/),h("search",/^\?[^#]*/),h("hash",/^#.*/),a.protocol=a.protocol||t.ENV.location.protocol,a.host?(a.host=a.host.substr(2),n=a.host.split(":"),a.hostname=n[0],a.port=n[1]||""):(a.host=t.ENV.location.host,a.hostname=t.ENV.location.hostname,a.port=t.ENV.location.port),a.pathname=a.pathname||"/",a.path=a.pathname+a.search,i=a.search.replace(/^\?/,""),s=i?i.split("&"):[],c={},r=0,o=s.length;o>r;r++)n=s[r].split("="),c[decodeURIComponent(n[0]||"")]=decodeURIComponent(n[1]||"");return a.query=c,a.href=this.stringify(a),a},stringify:function(t){var e=t.protocol+"//"+t.hostname;return t.port&&(e+=":"+t.port),e+=t.pathname+this.queryString(t.query)+(t.hash||"")},queryString:function(t){var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return 0===e.length?"":"?"+e.join("&")}},t.Error=t.Class({initialize:function(t,e,n){this.code=t,this.params=Array.prototype.slice.call(e),this.message=n},toString:function(){return this.code+":"+this.params.join(",")+":"+this.message}}),t.Error.parse=function(e){if(e=e||"",!t.Grammar.ERROR.test(e))return new this(null,[],e);var n=e.split(":"),i=parseInt(n[0]),s=n[1].split(","),e=n[2];return new this(i,s,e)},t.Error.versionMismatch=function(){return""+new this(300,arguments,"Version mismatch")},t.Error.conntypeMismatch=function(){return""+new this(301,arguments,"Connection types not supported")},t.Error.extMismatch=function(){return""+new this(302,arguments,"Extension mismatch")},t.Error.badRequest=function(){return""+new this(400,arguments,"Bad request")},t.Error.clientUnknown=function(){return""+new this(401,arguments,"Unknown client")},t.Error.parameterMissing=function(){return""+new this(402,arguments,"Missing required parameter")},t.Error.channelForbidden=function(){return""+new this(403,arguments,"Forbidden channel")},t.Error.channelUnknown=function(){return""+new this(404,arguments,"Unknown channel")},t.Error.channelInvalid=function(){return""+new this(405,arguments,"Invalid channel")},t.Error.extUnknown=function(){return""+new this(406,arguments,"Unknown extension")},t.Error.publishFailed=function(){return""+new this(407,arguments,"Failed to publish")},t.Error.serverError=function(){return""+new this(500,arguments,"Internal server error")},t.Deferrable={then:function(e,n){var i=this;return this._promise||(this._promise=new t.Promise(function(t,e){i._fulfill=t,i._reject=e})),0===arguments.length?this._promise:this._promise.then(e,n)},callback:function(t,e){return this.then(function(n){t.call(e,n)})},errback:function(t,e){return this.then(null,function(n){t.call(e,n)})},timeout:function(e,n){this.then();var i=this;this._timer=t.ENV.setTimeout(function(){i._reject(n)},1e3*e)},setDeferredStatus:function(e,n){this._timer&&t.ENV.clearTimeout(this._timer);var i=this.then();"succeeded"===e?this._fulfill(n):"failed"===e?this._reject(n):0!==i._state&&delete this._promise}},t.Publisher={countListeners:function(t){return this._subscribers&&this._subscribers[t]?this._subscribers[t].length:0},bind:function(t,e,n){this._subscribers=this._subscribers||{};var i=this._subscribers[t]=this._subscribers[t]||[];i.push([e,n])},unbind:function(t,e,n){if(this._subscribers&&this._subscribers[t]){if(!e)return delete this._subscribers[t],void 0;for(var i=this._subscribers[t],s=i.length;s--;)e===i[s][0]&&(n&&i[s][1]!==n||i.splice(s,1))}},trigger:function(){var t=Array.prototype.slice.call(arguments),e=t.shift();if(this._subscribers&&this._subscribers[e])for(var n,i=this._subscribers[e].slice(),s=0,r=i.length;r>s;s++)n=i[s],n[0].apply(n[1],t)}},t.Timeouts={addTimeout:function(e,n,i,s){if(this._timeouts=this._timeouts||{},!this._timeouts.hasOwnProperty(e)){var r=this;this._timeouts[e]=t.ENV.setTimeout(function(){delete r._timeouts[e],i.call(s)},1e3*n)}},removeTimeout:function(t){this._timeouts=this._timeouts||{};var e=this._timeouts[t];e&&(clearTimeout(e),delete this._timeouts[t])}},t.Logging={LOG_LEVELS:{fatal:4,error:3,warn:2,info:1,debug:0},writeLog:function(e,n){if(t.logger){var e=Array.prototype.slice.apply(e),i="[Faye",s=this.className,r=e.shift().replace(/\?/g,function(){try{return t.toJSON(e.shift())}catch(n){return"[Object]"}});for(var o in t)s||"function"==typeof t[o]&&this instanceof t[o]&&(s=o);s&&(i+="."+s),i+="] ","function"==typeof t.logger[n]?t.logger[n](i+r):"function"==typeof t.logger&&t.logger(i+r)}}},function(){for(var e in t.Logging.LOG_LEVELS)!function(e){t.Logging[e]=function(){this.writeLog(arguments,e)}}(e,t.Logging.LOG_LEVELS[e])}(),t.Grammar={CHANNEL_NAME:/^\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*$/,CHANNEL_PATTERN:/^(\/(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)))+)*\/\*{1,2}$/,ERROR:/^([0-9][0-9][0-9]:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*(,(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)*:(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*|[0-9][0-9][0-9]::(((([a-z]|[A-Z])|[0-9])|(\-|\_|\!|\~|\(|\)|\$|\@)| |\/|\*|\.))*)$/,VERSION:/^([0-9])+(\.(([a-z]|[A-Z])|[0-9])(((([a-z]|[A-Z])|[0-9])|\-|\_))*)*$/},t.Extensible={addExtension:function(t){this._extensions=this._extensions||[],this._extensions.push(t),t.added&&t.added(this)},removeExtension:function(t){if(this._extensions)for(var e=this._extensions.length;e--;)this._extensions[e]===t&&(this._extensions.splice(e,1),t.removed&&t.removed(this))},pipeThroughExtensions:function(t,e,n,i){if(this.debug("Passing through ? extensions: ?",t,e),!this._extensions)return n.call(i,e);var s=this._extensions.slice(),r=function(e){if(!e)return n.call(i,e);var o=s.shift();return o?(o[t]?o[t](e,r):r(e),void 0):n.call(i,e)};r(e)}},t.extend(t.Extensible,t.Logging),t.Channel=t.Class({initialize:function(t){this.id=this.name=t},push:function(t){this.trigger("message",t)},isUnused:function(){return 0===this.countListeners("message")}}),t.extend(t.Channel.prototype,t.Publisher),t.extend(t.Channel,{HANDSHAKE:"/meta/handshake",CONNECT:"/meta/connect",SUBSCRIBE:"/meta/subscribe",UNSUBSCRIBE:"/meta/unsubscribe",DISCONNECT:"/meta/disconnect",META:"meta",SERVICE:"service",expand:function(t){var e=this.parse(t),n=["/**",t],i=e.slice();i[i.length-1]="*",n.push(this.unparse(i));for(var s=1,r=e.length;r>s;s++)i=e.slice(0,s),i.push("**"),n.push(this.unparse(i));return n},isValid:function(e){return t.Grammar.CHANNEL_NAME.test(e)||t.Grammar.CHANNEL_PATTERN.test(e)},parse:function(t){return this.isValid(t)?t.split("/").slice(1):null},unparse:function(t){return"/"+t.join("/")},isMeta:function(t){var e=this.parse(t);return e?e[0]===this.META:null},isService:function(t){var e=this.parse(t);return e?e[0]===this.SERVICE:null},isSubscribable:function(t){return this.isValid(t)?!this.isMeta(t)&&!this.isService(t):null},Set:t.Class({initialize:function(){this._channels={}},getKeys:function(){var t=[];for(var e in this._channels)t.push(e);return t},remove:function(t){delete this._channels[t]},hasSubscription:function(t){return this._channels.hasOwnProperty(t)},subscribe:function(e,n,i){if(n)for(var s,r=0,o=e.length;o>r;r++){s=e[r];var c=this._channels[s]=this._channels[s]||new t.Channel(s);c.bind("message",n,i)}},unsubscribe:function(t,e,n){var i=this._channels[t];return i?(i.unbind("message",e,n),i.isUnused()?(this.remove(t),!0):!1):!1},distributeMessage:function(e){for(var n=t.Channel.expand(e.channel),i=0,s=n.length;s>i;i++){var r=this._channels[n[i]];r&&r.trigger("message",e.data)}}})}),t.Publication=t.Class(t.Deferrable),t.Subscription=t.Class({initialize:function(t,e,n,i){this._client=t,this._channels=e,this._callback=n,this._context=i,this._cancelled=!1},cancel:function(){this._cancelled||(this._client.unsubscribe(this._channels,this._callback,this._context),this._cancelled=!0)},unsubscribe:function(){this.cancel()}}),t.extend(t.Subscription.prototype,t.Deferrable),t.Client=t.Class({UNCONNECTED:1,CONNECTING:2,CONNECTED:3,DISCONNECTED:4,HANDSHAKE:"handshake",RETRY:"retry",NONE:"none",CONNECTION_TIMEOUT:60,DEFAULT_RETRY:5,MAX_REQUEST_SIZE:2048,DEFAULT_ENDPOINT:"/bayeux",INTERVAL:0,initialize:function(e,n){this.info("New client created for ?",e),this._options=n||{},this.endpoint=t.URI.parse(e||this.DEFAULT_ENDPOINT),this.endpoints=this._options.endpoints||{},this.transports={},this.cookies=t.CookieJar&&new t.CookieJar,this.headers={},this.ca=this._options.ca,this._disabled=[],this.retry=this._options.retry||this.DEFAULT_RETRY;for(var i in this.endpoints)this.endpoints[i]=t.URI.parse(this.endpoints[i]);this.maxRequestSize=this.MAX_REQUEST_SIZE,this._state=this.UNCONNECTED,this._channels=new t.Channel.Set,this._messageId=0,this._responseCallbacks={},this._advice={reconnect:this.RETRY,interval:1e3*(this._options.interval||this.INTERVAL),timeout:1e3*(this._options.timeout||this.CONNECTION_TIMEOUT)},t.Event&&t.Event.on(t.ENV,"beforeunload",function(){t.indexOf(this._disabled,"autodisconnect")<0&&this.disconnect()},this)},disable:function(t){this._disabled.push(t)},setHeader:function(t,e){this.headers[t]=e},handshake:function(e,n){if(this._advice.reconnect!==this.NONE&&this._state===this.UNCONNECTED){this._state=this.CONNECTING;var i=this;this.info("Initiating handshake with ?",t.URI.stringify(this.endpoint)),this._selectTransport(t.MANDATORY_CONNECTION_TYPES),this._send({channel:t.Channel.HANDSHAKE,version:t.BAYEUX_VERSION,supportedConnectionTypes:[this._transport.connectionType]},function(s){s.successful?(this._state=this.CONNECTED,this._clientId=s.clientId,this._selectTransport(s.supportedConnectionTypes),this.info("Handshake successful: ?",this._clientId),this.subscribe(this._channels.getKeys(),!0),e&&e.call(n)):(this.info("Handshake unsuccessful"),t.ENV.setTimeout(function(){i.handshake(e,n)},this._advice.interval),this._state=this.UNCONNECTED)},this)}},connect:function(e,n){if(this._advice.reconnect!==this.NONE&&this._state!==this.DISCONNECTED){if(this._state===this.UNCONNECTED)return this.handshake(function(){this.connect(e,n)},this);this.callback(e,n),this._state===this.CONNECTED&&(this.info("Calling deferred actions for ?",this._clientId),this.setDeferredStatus("succeeded"),this.setDeferredStatus("deferred"),this._connectRequest||(this._connectRequest=!0,this.info("Initiating connection for ?",this._clientId),this._send({channel:t.Channel.CONNECT,clientId:this._clientId,connectionType:this._transport.connectionType},this._cycleConnection,this)))}},disconnect:function(){this._state===this.CONNECTED&&(this._state=this.DISCONNECTED,this.info("Disconnecting ?",this._clientId),this._send({channel:t.Channel.DISCONNECT,clientId:this._clientId},function(t){t.successful&&this._transport.close()},this),this.info("Clearing channel listeners for ?",this._clientId),this._channels=new t.Channel.Set)},subscribe:function(e,n,i){if(e instanceof Array)return t.map(e,function(t){return this.subscribe(t,n,i)},this);var s=new t.Subscription(this,e,n,i),r=n===!0,o=this._channels.hasSubscription(e);return o&&!r?(this._channels.subscribe([e],n,i),s.setDeferredStatus("succeeded"),s):(this.connect(function(){this.info("Client ? attempting to subscribe to ?",this._clientId,e),r||this._channels.subscribe([e],n,i),this._send({channel:t.Channel.SUBSCRIBE,clientId:this._clientId,subscription:e},function(r){if(!r.successful)return s.setDeferredStatus("failed",t.Error.parse(r.error)),this._channels.unsubscribe(e,n,i);var o=[].concat(r.subscription);this.info("Subscription acknowledged for ? to ?",this._clientId,o),s.setDeferredStatus("succeeded")},this)},this),s)},unsubscribe:function(e,n,i){if(e instanceof Array)return t.map(e,function(t){return this.unsubscribe(t,n,i)},this);var s=this._channels.unsubscribe(e,n,i);s&&this.connect(function(){this.info("Client ? attempting to unsubscribe from ?",this._clientId,e),this._send({channel:t.Channel.UNSUBSCRIBE,clientId:this._clientId,subscription:e},function(t){if(t.successful){var e=[].concat(t.subscription);this.info("Unsubscription acknowledged for ? from ?",this._clientId,e)}},this)},this)},publish:function(e,n){var i=new t.Publication;return this.connect(function(){this.info("Client ? queueing published message to ?: ?",this._clientId,e,n),this._send({channel:e,data:n,clientId:this._clientId},function(e){e.successful?i.setDeferredStatus("succeeded"):i.setDeferredStatus("failed",t.Error.parse(e.error))},this)},this),i},receiveMessage:function(t){this.pipeThroughExtensions("incoming",t,function(t){if(t&&(t.advice&&this._handleAdvice(t.advice),this._deliverMessage(t),void 0!==t.successful)){var e=this._responseCallbacks[t.id];e&&(delete this._responseCallbacks[t.id],e[0].call(e[1],t))}},this)},_selectTransport:function(e){t.Transport.get(this,e,this._disabled,function(e){this.debug("Selected ? transport for ?",e.connectionType,t.URI.stringify(e.endpoint)),e!==this._transport&&(this._transport&&this._transport.close(),this._transport=e,e.bind("down",function(){(void 0===this._transportUp||this._transportUp)&&(this._transportUp=!1,this.trigger("transport:down"))},this),e.bind("up",function(){void 0!==this._transportUp&&this._transportUp||(this._transportUp=!0,this.trigger("transport:up"))},this))},this)},_send:function(t,e,n){t.id=this._generateMessageId(),e&&(this._responseCallbacks[t.id]=[e,n]),this.pipeThroughExtensions("outgoing",t,function(t){t&&this._transport.send(t,this._advice.timeout/1e3)},this)},_generateMessageId:function(){return this._messageId+=1,this._messageId>=Math.pow(2,32)&&(this._messageId=0),this._messageId.toString(36)},_handleAdvice:function(e){t.extend(this._advice,e),this._advice.reconnect===this.HANDSHAKE&&this._state!==this.DISCONNECTED&&(this._state=this.UNCONNECTED,this._clientId=null,this._cycleConnection())},_deliverMessage:function(t){t.channel&&void 0!==t.data&&(this.info("Client ? calling listeners for ? with ?",this._clientId,t.channel,t.data),this._channels.distributeMessage(t))},_teardownConnection:function(){this._connectRequest&&(this._connectRequest=null,this.info("Closed connection for ?",this._clientId))},_cycleConnection:function(){this._teardownConnection();var e=this;t.ENV.setTimeout(function(){e.connect()},this._advice.interval)}}),t.extend(t.Client.prototype,t.Deferrable),t.extend(t.Client.prototype,t.Publisher),t.extend(t.Client.prototype,t.Logging),t.extend(t.Client.prototype,t.Extensible),t.Transport=t.extend(t.Class({MAX_DELAY:0,batching:!0,initialize:function(t,e){this._client=t,this.endpoint=e,this._outbox=[]},close:function(){},encode:function(){return""},send:function(e,n){return this.debug("Client ? sending message to ?: ?",this._client._clientId,t.URI.stringify(this.endpoint),e),this.batching?(this._outbox.push(e),this._timeout=n,e.channel===t.Channel.HANDSHAKE?this.addTimeout("publish",.01,this.flush,this):(e.channel===t.Channel.CONNECT&&(this._connectMessage=e),this.flushLargeBatch(),this.addTimeout("publish",this.MAX_DELAY,this.flush,this),void 0)):this.request([e],n)},flush:function(){this.removeTimeout("publish"),this._outbox.length>1&&this._connectMessage&&(this._connectMessage.advice={timeout:0}),this.request(this._outbox,this._timeout),this._connectMessage=null,this._outbox=[]},flushLargeBatch:function(){var t=this.encode(this._outbox);if(!(t.length<this._client.maxRequestSize)){var e=this._outbox.pop();this.flush(),e&&this._outbox.push(e)}},receive:function(e){this.debug("Client ? received from ?: ?",this._client._clientId,t.URI.stringify(this.endpoint),e);for(var n=0,i=e.length;i>n;n++)this._client.receiveMessage(e[n])},retry:function(e,n){var i=!1,s=1e3*this._client.retry,r=this;return function(){i||(i=!0,t.ENV.setTimeout(function(){r.request(e,n)},s))}}}),{get:function(e,n,i,s,r){var o=e.endpoint;t.asyncEach(this._transports,function(c,a){var h=c[0],u=c[1],l=e.endpoints[h]||o;return t.indexOf(i,h)>=0?a():t.indexOf(n,h)<0?(u.isUsable(e,l,function(){}),a()):(u.isUsable(e,l,function(t){if(!t)return a();var n=u.hasOwnProperty("create")?u.create(e,l):new u(e,l);s.call(r,n)}),void 0)},function(){throw Error("Could not find a usable connection type for "+t.URI.stringify(o))})},register:function(t,e){this._transports.push([t,e]),e.prototype.connectionType=t},_transports:[]}),t.extend(t.Transport.prototype,t.Logging),t.extend(t.Transport.prototype,t.Publisher),t.extend(t.Transport.prototype,t.Timeouts),t.Event={_registry:[],on:function(t,e,n,i){var s=function(){n.call(i)};t.addEventListener?t.addEventListener(e,s,!1):t.attachEvent("on"+e,s),this._registry.push({_element:t,_type:e,_callback:n,_context:i,_handler:s})},detach:function(t,e,n,i){for(var s,r=this._registry.length;r--;)s=this._registry[r],t&&t!==s._element||e&&e!==s._type||n&&n!==s._callback||i&&i!==s._context||(s._element.removeEventListener?s._element.removeEventListener(s._type,s._handler,!1):s._element.detachEvent("on"+s._type,s._handler),this._registry.splice(r,1),s=null)}},t.Event.on(t.ENV,"unload",t.Event.detach,t.Event),t.Transport.WebSocket=t.extend(t.Class(t.Transport,{UNCONNECTED:1,CONNECTING:2,CONNECTED:3,batching:!1,isUsable:function(t,e){this.callback(function(){t.call(e,!0)}),this.errback(function(){t.call(e,!1)}),this.connect()},request:function(e){if(0!==e.length){this._messages=this._messages||{};for(var n=0,i=e.length;i>n;n++)this._messages[e[n].id]=e[n];this.callback(function(n){n&&n.send(t.toJSON(e))}),this.connect()}},close:function(){this._socket&&(this._socket.onclose=this._socket.onerror=null,this._socket.close(),delete this._socket,this.setDeferredStatus("deferred"),this._state=this.UNCONNECTED)},connect:function(){if(!t.Transport.WebSocket._unloaded&&(this._state=this._state||this.UNCONNECTED,this._state===this.UNCONNECTED)){this._state=this.CONNECTING;var e=t.Transport.WebSocket.getClass();if(!e)return this.setDeferredStatus("failed");var n=t.Transport.WebSocket.getSocketUrl(this.endpoint),i={headers:this._client.headers,ca:this._client.ca};this._socket=t.WebSocket?new e(n,[],i):new e(n);var s=this;this._socket.onopen=function(){s._state=s.CONNECTED,s._everConnected=!0,s.setDeferredStatus("succeeded",s._socket),s.trigger("up")},this._socket.onmessage=function(t){var e=JSON.parse(t.data);if(e){e=[].concat(e);for(var n=0,i=e.length;i>n;n++)delete s._messages[e[n].id];s.receive(e)}},this._socket.onclose=this._socket.onerror=function(){var e=s._state===s.CONNECTED;if(s.setDeferredStatus("deferred"),s._state=s.UNCONNECTED,s.close(),e)return s.resend();if(!s._everConnected)return s.setDeferredStatus("failed");var n=1e3*s._client.retry;t.ENV.setTimeout(function(){s.connect()},n),s.trigger("down")}}},resend:function(){if(this._messages){var e=t.map(this._messages,function(t,e){return e});this.request(e)}}}),{PROTOCOLS:{"http:":"ws:","https:":"wss:"},getSocketUrl:function(e){return e=t.copyObject(e),e.protocol=this.PROTOCOLS[e.protocol],t.URI.stringify(e)},getClass:function(){return t.WebSocket&&t.WebSocket.Client||t.ENV.WebSocket||t.ENV.MozWebSocket},isUsable:function(t,e,n,i){this.create(t,e).isUsable(n,i)},create:function(t,e){var n=t.transports.websocket=t.transports.websocket||{};return n[e.href]=n[e.href]||new this(t,e),n[e.href]}}),t.extend(t.Transport.WebSocket.prototype,t.Deferrable),t.Transport.register("websocket",t.Transport.WebSocket),t.Event&&t.Event.on(t.ENV,"beforeunload",function(){t.Transport.WebSocket._unloaded=!0}),t.Transport.EventSource=t.extend(t.Class(t.Transport,{initialize:function(e,n){if(t.Transport.prototype.initialize.call(this,e,n),!t.ENV.EventSource)return this.setDeferredStatus("failed");this._xhr=new t.Transport.XHR(e,n),n=t.copyObject(n),n.pathname+="/"+e._clientId;var i=new EventSource(t.URI.stringify(n)),s=this;i.onopen=function(){s._everConnected=!0,s.setDeferredStatus("succeeded"),s.trigger("up")},i.onerror=function(){s._everConnected?s.trigger("down"):(s.setDeferredStatus("failed"),i.close())},i.onmessage=function(t){s.receive(JSON.parse(t.data)),s.trigger("up")},this._socket=i},isUsable:function(t,e){this.callback(function(){t.call(e,!0)}),this.errback(function(){t.call(e,!1)})},encode:function(t){return this._xhr.encode(t)},request:function(t,e){this._xhr.request(t,e)},close:function(){this._socket&&(this._socket.onerror=null,this._socket.close(),delete this._socket)}}),{isUsable:function(e,n,i,s){var r=e._clientId;return r?(t.Transport.XHR.isUsable(e,n,function(t){return t?(this.create(e,n).isUsable(i,s),void 0):i.call(s,!1)},this),void 0):i.call(s,!1)},create:function(e,n){var i=e.transports.eventsource=e.transports.eventsource||{},s=e._clientId;n=t.copyObject(n),n.pathname+="/"+(s||"");var r=t.URI.stringify(n);return i[r]=i[r]||new this(e,n),i[r]}}),t.extend(t.Transport.EventSource.prototype,t.Deferrable),t.Transport.register("eventsource",t.Transport.EventSource),t.Transport.XHR=t.extend(t.Class(t.Transport,{encode:function(e){return t.toJSON(e)},request:function(e,n){var i=this.retry(e,n),s=this.endpoint.path,r=this,o=t.ENV.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;o.open("POST",s,!0),o.setRequestHeader("Content-Type","application/json"),o.setRequestHeader("Pragma","no-cache"),o.setRequestHeader("X-Requested-With","XMLHttpRequest");var c=this._client.headers;for(var a in c)c.hasOwnProperty(a)&&o.setRequestHeader(a,c[a]);var h=function(){o.abort()};t.Event.on(t.ENV,"beforeunload",h);var u=function(){t.Event.detach(t.ENV,"beforeunload",h),o.onreadystatechange=function(){},o=null};o.onreadystatechange=function(){if(4===o.readyState){var t=null,e=o.status,n=e>=200&&300>e||304===e||1223===e;if(!n)return u(),i(),r.trigger("down");try{t=JSON.parse(o.responseText)}catch(s){}u(),t?(r.receive(t),r.trigger("up")):(i(),r.trigger("down"))}},o.send(this.encode(e))}}),{isUsable:function(e,n,i,s){i.call(s,t.URI.isSameOrigin(n))}}),t.Transport.register("long-polling",t.Transport.XHR),t.Transport.CORS=t.extend(t.Class(t.Transport,{encode:function(e){return"message="+encodeURIComponent(t.toJSON(e))},request:function(e,n){var i,s=t.ENV.XDomainRequest?XDomainRequest:XMLHttpRequest,r=new s,o=this.retry(e,n),c=this._client.headers,a=this;if(r.open("POST",t.URI.stringify(this.endpoint),!0),r.setRequestHeader){r.setRequestHeader("Pragma","no-cache");for(i in c)c.hasOwnProperty(i)&&r.setRequestHeader(i,c[i])}var h=function(){return r?(r.onload=r.onerror=r.ontimeout=r.onprogress=null,r=null,t.ENV.clearTimeout(l),!0):!1};r.onload=function(){var t=null;try{t=JSON.parse(r.responseText)}catch(e){}h(),t?(a.receive(t),a.trigger("up")):(o(),a.trigger("down"))};var u=function(){h(),o(),a.trigger("down")},l=t.ENV.setTimeout(u,1500*n);r.onerror=u,r.ontimeout=u,r.onprogress=function(){},r.send(this.encode(e))}}),{isUsable:function(e,n,i,s){if(t.URI.isSameOrigin(n))return i.call(s,!1);if(t.ENV.XDomainRequest)return i.call(s,n.protocol===t.ENV.location.protocol);if(t.ENV.XMLHttpRequest){var r=new t.ENV.XMLHttpRequest;return i.call(s,void 0!==r.withCredentials)}return i.call(s,!1)}}),t.Transport.register("cross-origin-long-polling",t.Transport.CORS),t.Transport.JSONP=t.extend(t.Class(t.Transport,{encode:function(e){var n=t.copyObject(this.endpoint);return n.query.message=t.toJSON(e),n.query.jsonp="__jsonp"+t.Transport.JSONP._cbCount+"__",t.URI.stringify(n)},request:function(e,n){var i=document.getElementsByTagName("head")[0],s=document.createElement("script"),r=t.Transport.JSONP.getCallbackName(),o=t.copyObject(this.endpoint),c=this.retry(e,n),a=this;o.query.message=t.toJSON(e),o.query.jsonp=r,t.ENV[r]=function(t){u(),a.receive(t),a.trigger("up")};var h=t.ENV.setTimeout(function(){u(),c(),a.trigger("down")},1500*n),u=function(){if(!t.ENV[r])return!1;t.ENV[r]=void 0;try{delete t.ENV[r]}catch(e){}return t.ENV.clearTimeout(h),s.parentNode.removeChild(s),!0};s.type="text/javascript",s.src=t.URI.stringify(o),i.appendChild(s)}}),{_cbCount:0,getCallbackName:function(){return this._cbCount+=1,"__jsonp"+this._cbCount+"__"},isUsable:function(t,e,n,i){n.call(i,!0)}}),t.Transport.register("callback-polling",t.Transport.JSONP)}();
//@ sourceMappingURL=faye-browser-min.js.map